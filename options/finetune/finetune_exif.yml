# Finetuning configuration for DarkIR with EXIF data
# Modify paths and hyperparameters according to your dataset

#### GPU configuration
gpu: "0"  # GPU device to use

#### datasets
datasets:
  name: Custom  # Name of your dataset
  train:
    train_path: ../dataset/finetune/train  # Path to training data (should have 'low' and 'high' subdirectories)
    batch_size: 4
    cropsize: 256  # Random crop size for training
    n_workers: 0  # Number of data loading workers per GPU
    verbose: True
    use_exif: True
    exif_path: ../dataset/finetune/train/exif # Path to folder containing json files
  val:
    test_path: ../dataset/finetune/test  # Path to validation data
    batch_size_test: 1
    use_exif: True
    exif_path: ../dataset/finetune/test/exif # Path to folder containing json files

#### network structures
network:
  name: DarkIR
  pretrained_path: ./models/DarkIR_1k_cr_mt.pt  # Path to pretrained model weights
  resume_training: False
  img_channels: 3
  width: 32
  middle_blk_num_enc: 2
  middle_blk_num_dec: 2
  enc_blk_nums: [1, 2, 3]
  dec_blk_nums: [3, 1, 1]
  dilations: [1, 4, 9]
  extra_depth_wise: True
  # vec_dim: 6 # This will be automatically set by the script if use_exif is True

#### training settings
train:
  epochs: 15
  lr_initial: 0.0001  # Initial learning rate (reduced for finetuning)
  lr_scheme: CosineAnnealing
  eta_min: 0.000001  # Minimum learning rate
  weight_decay: 0.0001
  betas: [0.9, 0.999]
  use_side_loss: True  # Disable since EnhanceLoss is commented out
  use_fp16: False  # Disable mixed precision to avoid potential numerical issues
  use_exif: True
  exif_path: ../dataset/finetune/train/exif

#### loss functions
losses:
  main_loss:
    type: CharbonnierLoss  # L1Loss, MSELoss, CharbonnierLoss
    weight: 1
  
  # ssim_loss:
  #   type: SSIMloss
  #   weight: 0.05
  
  # Optional: Uncomment to use perceptual loss
  perceptual_loss:
    type: VGGLoss
    weight: 0.01
  
  # Optional: Uncomment to use frequency loss
  # frequency_loss:
  #   type: FrequencyLoss
  #   weight: 0.01
  
  # Optional: Uncomment to use edge loss
  edge_loss:
    type: EdgeLoss
    weight: 50
  
  # Optional: Enhancement loss for middle output (requires use_side_loss: True)
  enhance_loss:
    type: EnhanceLoss
    weight: 1

#### model saving
save:
  path: ./models/finetuned_exif_modified_loss  # Directory to save finetuned models

#### wandb logging (optional)
wandb:
  init: True  # Set to True to enable Weights & Biases logging
  project: DarkIR-Finetune
  entity: lllion66666 # Replace with your wandb username or team name
  name: finetune_exif_experiment_modified_loss
  save_code: True
  resume: False
  id: null
  dir: ./wandb_logs
